<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>A service renewal of backend built upon AWS Lambda | Kenzan Hase</title> <meta name="author" content="Kenzan Hase"> <meta name="description" content="I recently worked on a website backend migration. This blog post explains how we tackled the issues."> <meta name="keywords" content="portfolio, blog"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%92%BE&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kenzan8000.org/blog/a-service-renewal-of-backend-built-upon-aws-lambda/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Kenzan Hase</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">A service renewal of backend built upon AWS Lambda</h1> <p class="post-meta">February 16, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/typescript"> <i class="fas fa-hashtag fa-sm"></i> TypeScript</a>   <a href="/blog/tag/nestjs"> <i class="fas fa-hashtag fa-sm"></i> NestJS</a>   <a href="/blog/tag/aws"> <i class="fas fa-hashtag fa-sm"></i> AWS</a>   <a href="/blog/tag/datadog"> <i class="fas fa-hashtag fa-sm"></i> Datadog</a>     ·   <a href="/blog/category/backend"> <i class="fas fa-tag fa-sm"></i> Backend</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>I recently worked on <a href="https://38qa.net/" rel="external nofollow noopener" target="_blank">38qa.net</a> migration as a backend developer. The current 38qa.net is one monolithic app based on <a href="https://github.com/q2a/question2answer" rel="external nofollow noopener" target="_blank">question2answer</a> which is an open source Q&amp;A platform for PHP/MySQL. (The new one hasn’t been released yet as of February, 2021.) We divided the app into frontend and backend written in TypeScript but still kept the same feature it used to have. On this blog post, I would like to look back the backend development.</p> <h2 id="motivation">Motivation</h2> <p>The current app uses a monolithic framework called <a href="https://github.com/q2a/question2answer" rel="external nofollow noopener" target="_blank">question2answer</a>. The framework has been barely maintained but there are lots of legacy code in it. Besides, the old app heavily depends on the extension <a href="https://docs.question2answer.org/plugins/" rel="external nofollow noopener" target="_blank">plugins</a> of the framework. That makes the code more difficult to make new changes and scale the project. To run the service for another decade, the business owner wants to pay off the technical debt.</p> <h2 id="tech-stack">Tech Stack</h2> <h3 id="typescript">TypeScript</h3> <p>38qa.net is owned by a small company called <a href="https://syumatsu-yoho.co.jp/" rel="external nofollow noopener" target="_blank">weekend bee-keeping</a> (週末養蜂). As of 2021, it is easier for them to find a TypeScript and React developer rather than a PHP developer since the company hires freelance developers. Also, it is easier for the developers to read and write both frontend and backend code in the same programming language. The common code can be shared on both sides as well. Therefore, the owner decided to use TypeScript.</p> <h3 id="nestjs">NestJS</h3> <p>The frontend framework was already fixed before I joined the development since <a href="https://github.com/facebook/react" rel="external nofollow noopener" target="_blank">React</a> is the recent main stream. I looked for a backend framework. Then I found <a href="https://github.com/nestjs/nest" rel="external nofollow noopener" target="_blank">NestJS</a>. NestJS provides Rails-Like intuitive project structure, testing, and command-line tools. <a href="https://github.com/rails/rails" rel="external nofollow noopener" target="_blank">Rails</a>-Like framework would be a good fit for a small company like weekend bee-keeping due to the balance between good maintainability as long as you ride on the rail and high speed development especially within small number of teammates. Moreover, NestJS has a huge and active developer’s community. Here is a <a href="https://github.com/kenzan8000/nestjs-lambda-boilerplate" rel="external nofollow noopener" target="_blank">nestjs sample project</a>.</p> <h3 id="fastify">Fastify</h3> <p>NestJS makes use of Express under the hood but provides compatibility with a wide range of other servers like <a href="https://github.com/fastify/fastify" rel="external nofollow noopener" target="_blank">Fastify</a>. Fastify would be a faster and lower overhead server than Express according to the <a href="https://github.com/fastify/fastify#benchmarks" rel="external nofollow noopener" target="_blank">benchmark</a>. In addition, the developer’s community is huge and active, too.</p> <h2 id="architecture">Architecture</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-architecture-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-architecture-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-architecture-1400.webp"></source> <img src="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-architecture.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Architecture" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="serverless--aws-lambda">Serverless + AWS Lambda</h3> <p>The current app was originally hosted on a single <a href="https://aws.amazon.com/ec2" rel="external nofollow noopener" target="_blank">AWS EC2</a> instance. The business owner was interested in the architecture built by <a href="https://github.com/serverless/serverless" rel="external nofollow noopener" target="_blank">Serverless</a> on <a href="https://aws.amazon.com/lambda/" rel="external nofollow noopener" target="_blank">AWS Lambda</a> since he wanted to use a modern technology and save the server cost. I actually imagined the new architecture would be on <a href="https://aws.amazon.com/ecs" rel="external nofollow noopener" target="_blank">AWS ECS</a> or <a href="https://aws.amazon.com/eks/" rel="external nofollow noopener" target="_blank">EKS</a> but I didn’t stick to any specific one. Why don’t we try Lambda out? He and I decided to take Lambda first but if it’s hard, we move on to another architecture.</p> <h3 id="autoscaling">Autoscaling</h3> <p>AWS Lambda is pretty easy to use because it already provides automated scaling and complete elimination of container maintenance. However, there was a problem. If none of your Lambda functions have been invoked in some time, it takes time until your application code is executed. The slow launching problem is called Cold Start. Fortunately, <a href="https://aws.amazon.com/about-aws/whats-new/2019/12/aws-lambda-announces-provisioned-concurrency" rel="external nofollow noopener" target="_blank">AWS announced a solution called Provisioned Concurrency at the end of 2019</a>.</p> <p>With Provisioned Concurrency, functions can instantaneously serve a burst of traffic with consistent start-up latency for every invoke up to the specified scale.</p> <p>Thank the developer’s community and the great <a href="https://web.archive.org/web/20230203031220/https://medium.com/neiman-marcus-tech/serverless-provisioned-concurrency-autoscaling-3d8ec23d10c" rel="external nofollow noopener" target="_blank">Serverless plugin</a>.</p> <h3 id="mysql">MySQL</h3> <p>We continue to use the same MySQL database the current app uses but there was the following problem.</p> <p>Many applications, including those built on modern serverless architectures, can have a large number of open connections to the database server, and may open and close database connections at a high rate, exhausting database memory and compute resources.</p> <p>Fortunately, <a href="https://aws.amazon.com/blogs/aws/amazon-rds-proxy-now-generally-available" rel="external nofollow noopener" target="_blank">AWS announced a solution called RDS Proxy on 2020</a>.</p> <p>Amazon RDS Proxy allows applications to pool and share connections established with the database, improving database efficiency and application scalability.</p> <h3 id="cognito">Cognito</h3> <p>We use <a href="https://aws.amazon.com/cognito" rel="external nofollow noopener" target="_blank">Amazon Cognito</a> to handle the user authentication.</p> <p>Amazon Cognito lets you add user sign-up, sign-in, and access control to your web and mobile apps quickly and easily. Amazon Cognito scales to millions of users and supports sign-in with social identity providers, such as Facebook, Google, and Amazon, and enterprise identity providers via SAML 2.0.</p> <p>The current app already has the own implementation of the user authentication. However, the implementation is a bit legacy. On the other hand, Cognito is a well-designed system maintained by Amazon. Also, we expect the synergetic effect because most of 38qa.net tech stack is on AWS. For example, <a href="https://aws.amazon.com/ses" rel="external nofollow noopener" target="_blank">Amazon SES</a> can send the email to a user when the user signs in for the first time. This kind of the integration is easily done on AWS Management Console.</p> <p>To migrate the app users to Amazon Cognito User Pools, <a href="https://web.archive.org/web/20230606003242/https://aws.amazon.com/blogs/mobile/migrating-users-to-amazon-cognito-user-pools/" rel="external nofollow noopener" target="_blank">Cognito prepares some options</a>. One option is one-at-a-time user migration.</p> <p>The one-at-a-time user migration method involves first attempting to sign in the user through the Amazon Cognito User Pool. Then, if that sign-in fails, you sign them in through the existing user directory and capture the user name and password to silently create the user in the user pool.</p> <p>Cognito invokes Lambda function for the first attempt when a user signs in but the user doesn’t exist in the user pool yet. The data for the migration is exchanged between Cognito and your Lambda function through the Webhook-Like procedure below.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-cognito-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-cognito-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-cognito-1400.webp"></source> <img src="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-cognito.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Cognito" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="cron-job">Cron Job</h3> <p>The new 38qa.net cron job can be classified as three types. They are executed on Lambda function.</p> <p>The first one is a scheduler running jobs on your app every scheduled time interval. For example, ranking table is updated every hour.</p> <p>Second one is an event triggered by a certain condition. For example, when an image is uploaded, the cron job generates a thumbnail image from the original image.</p> <p>The other one is one-time job that runs only once. For example, the current app had binary image data in the db column. The cron job uploads the image to the storage.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-cron-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-cron-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-cron-1400.webp"></source> <img src="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-cron.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Cron" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="datadog">Datadog</h3> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-datadog-dashboard-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-datadog-dashboard-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-datadog-dashboard-1400.webp"></source> <img src="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-datadog-dashboard.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Datadog dashboard" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The new 38qa.net uses <a href="https://www.datadoghq.com/" rel="external nofollow noopener" target="_blank">Dabtadog</a> for the backend monitoring. Datadog monitors the useful metrics to optimize serverless function such as errors and cold starts, allocated memory, environment, etc. It identifies high-level function issues, and provides the intuitive traces and logs on the dashboard.</p> <p>Your Lambda metrics go to CloudWatch via Datadog Lambda layer first. Then another Lambda function called Datadog Forwarder subscribes the CloudWatch updates and pushes them into Datadog.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-datadog-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-datadog-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-datadog-1400.webp"></source> <img src="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-datadog.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Datadog" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="load-testing">Load Testing</h3> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-artillery-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-artillery-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-artillery-1400.webp"></source> <img src="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-artillery.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Artillery" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>To run the load testing, I decided to use <a href="https://artillery.io/" rel="external nofollow noopener" target="_blank">artillery</a>. Artillery allows you to make performance and functionality testing quickly, easily and without having to maintain any servers or testing infrastructure. I also used <a href="https://github.com/Nordstrom/serverless-artillery" rel="external nofollow noopener" target="_blank">serverless-artillery</a> plugin that helps you easily install the load testing environment on Lambda and <a href="https://www.npmjs.com/package/artillery-plugin-datadog" rel="external nofollow noopener" target="_blank">artillery-plugin-datadog</a> plugin that submits Artillery metrics to Datadog over HTTPS.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-artillery-on-datadog-dashboard-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-artillery-on-datadog-dashboard-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-artillery-on-datadog-dashboard-1400.webp"></source> <img src="/assets/img/2021-02-17-a-service-renewal-of-backend-built-upon-aws-lambda-artillery-on-datadog-dashboard.jpg" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Artillery on Datadog dashboard" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>By the way, for the rate limiting, I used <a href="https://github.com/ozkanonur/nestjs-rate-limiter" rel="external nofollow noopener" target="_blank">nestjs-rate-limiter</a> which adds in configurable rate limiting.</p> <h2 id="conclusion">Conclusion</h2> <p>I firstly doubted if it is possible to build a fully functioning system on AWS Lambda. There are still some problems that aren’t perfectly solved yet. i.e. Cold Start problem. However, as a result, the recent AWS updates enable you to build most of the architecture on AWS Lambda.</p> </div> </article><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"kenzan8000/kenzan8000.github.io","data-repo-id":"R_kgDOKRPp2A","data-category":"Comments","data-category-id":"DIC_kwDOA5PmLc4CTBt6","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Kenzan Hase. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>